from abc import abstractmethod
from collections.abc import Mapping
from dataclasses import dataclass


@dataclass(frozen=True)
class BandRegion(Mapping):
    """Generic region to field mapping."""

    regions: str

    def __post_init__(self):
        """Check that requested regions are defined."""
        if any(str(r) not in self.field_dict.keys() for r in self.regions):
            missing = sorted(list(set(self.regions) - set(self.field_dict.keys())))
            missing = ', '.join(missing)
            raise ValueError(f"Region(s) {missing} not defined in this band")

    def __repr__(self):
        region_list = sorted(list(self.regions))
        return f"{self.__class__.__name__}({region_list})"

    def __eq__(self, other):
        return self.fields == other.fields

    def __getitem__(self, region: str):
        return self.field_dict[region]

    def __iter__(self):
        return iter(self.fields)

    def __len__(self):
        return len(self.fields)

    @property
    @abstractmethod
    def field_dict(self):
        """Mapping from region numbers to a list of field names."""

    @property
    def fields(self):
        """Get list of fields within specified regions."""
        return [f for region in self.regions for f in self.field_dict[str(region)]]


class LowBandRegion(BandRegion):
    """VAST region mapping for low-band, square-36 tiles."""

    field_dict = {
        '1': ['2004+00', '2004-06', '2028+00', '2028-06', '2053+00', '2053-06', '2118+00',
              '2118-06', '2143+00', '2143-06', '2208+00', '2208-06', '2257+00', '2257-06',
              '2322+00', '2322-06', '2347+00', '2347-06', '2233+00', '2233-06', '0012+00',
              '0012-06', '0037+00', '0037-06', '0102+00', '0102-06', '0126+00', '0126-06',
              '0151+00', '0151-06', '0216+00', '0216-06', '0241+00', '0241-06', '0306+00',
              '0306-06', '0331+00', '0331-06', '0355+00', '0355-06',],
        '2': ['0918+00', '0918-06', '0943+00', '0943-06', '1008+00', '1008-06', '1033+00',
              '1033-06', '1057+00', '1057-06', '1122+00', '1122-06', '1147+00', '1147-06',
              '1212+00', '1212-06', '1237+00', '1237-06', '1302+00', '1302-06', '1326+00',
              '1326-06', '1351+00', '1351-06', '1416+00', '1416-06', '1441+00', '1441-06',],
        '3': ['0304-50', '0310-56', '0318-62', '0320-43', '0341-50', '0352-56', '0354-43',
              '0408-62', '0418-50', '0427-43', '0435-56', '0455-50', '0457-62', '0501-43',
              '0517-56', '0530-68', '0532-50', '0534-43', '0547-62', '0559-56',],
        '4': ['2005-43', '2007-56', '2018-50', '2039-43', '2041-62', '2049-56', '2055-50',
              '2112-43', '2131-56', '2131-62', '2132-50', '2146-43', '2209-50', '2214-56',
              '2219-43', '2220-62', '2246-50', '2253-43', '2256-56',],
        '5': ['1724-31', '1739-25', '1752-31', '1753-18', '1806-25',],
        '6': ['0127-73',],
    }

    
class MidBandRegion(BandRegion):
    """VAST region mapping for mid-band, closepack-36 tiles."""

    field_dict = {
        '1': ['0021+00', '0021-04', '0042+00', '0042-04', '0104+00', '0104-04', '0125+00',
              '0125-04', '0147+00', '0147-04', '0208+00', '0208-04', '0230+00', '0230-04',
              '0251+00', '0251-04', '0313+00', '0313-04', '0334+00', '0334-04', '0352-64',
              '0356+00', '0356-04', '2108+00', '2108-04', '2129+00', '2129-04', '2003+00',
              '2003-04', '2046+00', '2046-04', '2255+00', '2255-04', '2306-55', '2234+00',
              '2234-04', '2317+00', '2317-04', '2338+00', '2338-04', '2359+00', '2359-04' 
              '2025+00', '2025-04'],
        '2': [],
        '3': ['0438-64', '0504-69', '0525-64', '0559-69'],
        '4': ['2004-41', '2006-55', '2014-46', '2027-51', '2032-41', '2034-60', '2042-55',
              '2044-46', '2054-64', '2059-41', '2059-51', '2114-46', '2115-60', '2118-55',
              '2127-41', '2132-51', '2140-64', '2144-46', '2151+00', '2151-04', '2154-55',
              '2155-41', '2156-60', '2205-51', '2212+00', '2212-04', '2214-46', '2223-41',
              '2227-64', '2230-55', '2237-60', '2238-51', '2244-46', '2250-41'],
        '5': ['1724-28', '1731-23', '1735-32', '1748-18', '1748-28', '1754-23', '1800-32',
              '1812-28'],
        '6': ['0113-72']
    }

